<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="POS - Bootstrap Admin Template">
    <meta name="keywords"
        content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
    <meta name="author" content="Dreamguys - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <title>Spice Shop</title>

    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.png">

    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <link rel="stylesheet" href="assets/css/animate.css">

    <link rel="stylesheet" href="assets/plugins/owlcarousel/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/plugins/owlcarousel/owl.theme.default.min.css">

    <link rel="stylesheet" href="assets/plugins/select2/css/select2.min.css">

    <link rel="stylesheet" href="assets/css/bootstrap-datetimepicker.min.css">

    <link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">

    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div id="global-loader">
        <div class="whirly-loader"> </div>
    </div>

    <div class="main-wrappers">
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <div class="header" style="background:rgba(234, 84, 85, .12)">
            <div class=" header-left border-0 ">
                <a href="index.html" class="logo">
                    <img src="assets/img/logo.png" alt="">
                </a>
                <a href="index.html" class="logo-small">
                    <img src="assets/img/logo.png" alt="">
                </a>
            </div>


            <ul class="nav user-menu">

                <li class="nav-item">
                    <div class="top-nav-search">
                        <a href="javascript:void(0);" class="responsive-search">
                            <i class="fa fa-search"></i>
                        </a>
                        <form action="#">
                            <div class="searchinputs">
                                <input type="text" placeholder="Search Here ...">
                                <div class="search-addon">
                                    <span><img src="assets/img/icons/closes.svg" alt="img"></span>
                                </div>
                            </div>
                            <a class="btn" id="searchdiv"><img src="assets/img/icons/search.svg" alt="img"></a>
                        </form>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a href="javascript:void(0);" class="dropdown-toggle nav-link" data-bs-toggle="dropdown">
                        <img src="assets/img/icons/notification-bing.svg" alt="img"> <span
                            class="badge rounded-pill">4</span>
                    </a>
                    <div class="dropdown-menu notifications">
                        <div class="topnav-dropdown-header">
                            <span class="notification-title">Notifications</span>
                            <a href="javascript:void(0)" class="clear-noti"> Clear All </a>
                        </div>
                        <div class="noti-content">
                            <ul class="notification-list">
                                <li class="notification-message">
                                    <a href="#">
                                        <div class="media d-flex">
                                            <span class="avatar flex-shrink-0">
                                                <img alt="" src="assets/img/profiles/avatar-13.jpg">
                                            </span>
                                            <div class="media-body flex-grow-1">
                                                <p class="noti-details"><span class="noti-title">Bernardo Galaviz</span>
                                                    added new task <span class="noti-title">Private chat module</span>
                                                </p>
                                                <p class="noti-time"><span class="notification-time">2 days ago</span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="topnav-dropdown-footer">
                            <a href="#">View all Notifications</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item dropdown has-arrow main-drop">
                    <a href="javascript:void(0);" class="dropdown-toggle nav-link userset" data-bs-toggle="dropdown">
                        <span class="user-img"><img src="assets/img/profiles/avator1.jpg" alt="">
                            <span class="status online"></span></span>
                    </a>
                    <div class="dropdown-menu menu-drop-user">
                        <div class="profilename">
                            <div class="profileset">
                                <span class="user-img"><img src="assets/img/profiles/avator1.jpg" alt="">
                                    <span class="status online"></span></span>
                                <div class="profilesets">
                                    <h6>Mushfique</h6>
                                    <h5>Admin</h5>
                                </div>
                            </div>
                            <hr class="m-0">
                            <a class="dropdown-item" href="profile.html"> <svg xmlns="http://www.w3.org/2000/svg"
                                    width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                    class="feather feather-user me-2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg> My Profile</a>
                            <a class="dropdown-item" href="generalsettings.html"><svg xmlns="http://www.w3.org/2000/svg"
                                    width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                    class="feather feather-settings me-2">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path
                                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                                    </path>
                                </svg>Settings</a>
                            <hr class="m-0">
                            <a class="dropdown-item logout pb-0" href="/logout"><img src="assets/img/icons/log-out.svg"
                                    class="me-2" alt="img">Logout</a>
                        </div>
                    </div>
                </li>
            </ul>


            <div class="dropdown mobile-user-menu">
                <a href="javascript:void(0);" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                    aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="profile.html">My Profile</a>
                    <a class="dropdown-item" href="generalsettings.html">Settings</a>
                    <a class="dropdown-item" href="../templates/login.html">Logout</a>
                </div>
            </div>

        </div>

        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->
        <!-- ----------------------------------------------------------------------------------------------------------- -->

        <div class="page-wrapper ms-0">
            <div class="content">
                <div class="row">
                    <div class="col-lg-4 col-sm-12 tabs_wrapper">
                        <div class="page-header ">
                            <div class="page-title"
                                style="background:rgba(234, 84, 85, .12);padding: 1rem;border-radius: 8px;">
                                <h4>Manage your purchases</h4>
                            </div>
                        </div>

                        <div class="row" id="productContainer">

                        </div>
                    </div>

                    <div class="col-lg-8 col-sm-12 ">
                        <div class="order-list">
                            <div class="orderid">
                                <h4>Order List</h4>
                            </div>
                        </div>
                        <div class="card card-order">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12">
                                        <a href="addsupplier.html" class="btn btn-adds"><i
                                                class="fa fa-plus me-2"></i>Add
                                            Supplier</a>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="select-split ">
                                            <div class="select-group w-100">
                                                <input type="text" list='suppliers' id="supplier"
                                                    style="border:1px solid #637381;width:100%;border-radius: 4px; padding:6px 0 6px 0;">
                                                <datalist id="suppliers">
                                                    <option>Walk-In-Supplier</option>
                                                </datalist>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card-body pt-0">
                                <div class="totalitem">
                                    <h4 id="totalItems"></h4>
                                    <a href="javascript:void(0);">Clear all</a>
                                </div>
                                <div class="product-table" id="productTable" style="height: unset;">
                                    <ul class="product-lists">
                                        <li>
                                            <div class="productimg">
                                                <div class="totalitem">
                                                    <h4>Product</h4>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="totalitem">
                                                <h4>Price<br>per unit</h4>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="totalitem">
                                                <h4>Quantity</h4>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="totalitem">
                                                <h4>Qty after<br>cut down</h4>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="totalitem">
                                                <h4>Price</h4>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="totalitem">
                                                <h4>Remove</h4>
                                            </div>
                                        </li>
                                    </ul>
                                    <style>
                                        .product-lists li {
                                            border-right: 1px solid #ccc;
                                            /* Add a right border to each li element */
                                            padding-right: 10px;
                                            /* Add some padding to create space between items */
                                            margin-right: 10px;
                                            /* Add some margin to create space between items */
                                        }

                                        /* Remove the right border from the last li element */
                                        .product-lists li:last-child {
                                            border-right: none;
                                        }
                                    </style>
                                </div>
                            </div>

                            <div class="card-body pt-0 pb-2">
                                <div class="setvalue">
                                    <ul>
                                        <li class="total-value">
                                            <h5>Total </h5>
                                            <h6 id="total">00.00</h6>
                                        </li>
                                    </ul>
                                </div>
                                <div class="setvaluecash">
                                    <ul>
                                        <li>
                                            <a href="javascript:void(0);" class="paymentmethod">
                                                <img src="assets/img/icons/cash.svg" alt="img" class="me-2">
                                                Cash
                                            </a>
                                        </li>
                                        <li>
                                            <a href="javascript:void(0);" class="paymentmethod">
                                                <img src="assets/img/icons/debitcard.svg" alt="img" class="me-2">
                                                Cheque
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="btn-totallabel" id="checkoutTotal">
                                    <h5>Checkout</h5>
                                    <h6 id="total2">00.00</h6>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>




    <!-- Modal HTML -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-content"></div>
        </div>
    </div>


    <!-- ------------------------------------invoice modal------------------ ------------------------------------>
    <div class="modal fade" id="create" tabindex="-1" aria-labelledby="create" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productTitle"></h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12 col-sm-12 col-12">
                            <div
                                style="display: grid; grid-template-columns: repeat(2,1fr); gap: 1rem; padding-top: 10px;">

                                <div class="form-group">
                                    <label>Quantity</label>
                                    <input type="number" step=".01" id="quantity-m" required>
                                </div>
                                <div class="form-group">
                                    <label>Cut Quantity</label>
                                    <input type="number" step=".01" id="dropQty-m" value="0">
                                </div>
                            </div>

                            <div
                                style="display: grid; grid-template-columns: repeat(2,1fr); gap: 1rem; padding-top: 10px;">

                                <div class="form-group">
                                    <label>Price per unit</label>
                                    <input type="number" step=".01" id="pricePerUnit-m" required>
                                </div>
                                <div class="form-group" id="percent">
                                    <label>Dried percentage</label>
                                    <input type="number" step=".01" id="driedPercentage-m" required
                                        oninput="validateInput(this)">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Product quality</label>
                                <select class="form-select" id="quality" required>
                                    <option></option>
                                    <option>Good</option>
                                    <option>Average</option>
                                    <option>Bad</option>
                                </select>
                            </div>
                            <div id="error-message" style="color: red; display: none;">Please fill in all required
                                fields.</div>
                            <div id="error-messageMin" style="color: red; display: none;">Please fill percentage between
                                1 and 100 </div>
                            <input type="hidden" id="productIdInput">
                            <input type="hidden" id="productNameInput">
                            <input type="hidden" id="productImageUrlInput">
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <a class="btn btn-submit me-2" onclick="addTransactionDataToList()">Submit</a>
                        <a class="btn btn-cancel" data-bs-dismiss="modal">Cancel</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ------------------------------------invoice modal  END----------------------------------------->
    <template id="product-template">
        <div class="col-lg-4 col-sm-2 d-flex" id="image">
            <a href="javascript:void(0);" data-bs-toggle="modal" data-bs-target="#create">
                <div class="productset flex-fill active">
                    <div class="productsetimg">
                        <img style="aspect-ratio: 1/1; width: 100px; object-fit: cover;" id="imgDisplayed" alt="img">
                    </div>
                    <div id="productDet" class="productsetcontent">
                        <h4></h4>
                        <h4 style="font-size:10px;"></h4>
                    </div>
                </div>
            </a>
        </div>
    </template>

    <template id="transaction-item-template">
        <ul class="product-lists" data-id="">
            <li class="productimg">
                <div class="productimgs"><img alt="img">
                    <h4></h4>
                    <input type="hidden" id="id">
                    <input type="hidden" id="quality">
                    <input type="hidden" id="driedPercentage">
                </div>
            </li>
            <li></li>
            <li></li>
            <li></li>
            <li class='total'></li>
            <li data-action="delete">
                <button class="confirm-text" style='background-color: transparent; border: none;'>
                    <img src="assets/img/icons/delete-2.svg" alt="img" />
                </button>
            </li>
        </ul>
    </template>

    <script>
        window.onload = function () {
            // const products =
            //     [
            //         { id: 1, name: "Rubber", quantity: 5.0, imageUrl: "" },
            //         { id: 2, name: "Rubber", quantity: 5.0, imageUrl: "" }
            //         // Add more products here
            //     ];
            // addProductsToPage(products);
            loadProducts();
            loadSupplier();

        }

        // Function to add products to the categories
        function addProductsToPage(products) {
            var templateImage = document.querySelector('template').content.querySelector('div');
            var productContainer = document.getElementById("productContainer");
            let dataArray = "";

            ////////////////
            products.forEach(function (item) {
                // Clone the template row
                var newImage = templateImage.cloneNode(true);

                // Populate the cloned row with data
                newImage.querySelector('#imgDisplayed').src = item.imageUrl;
                newImage.querySelectorAll('#productDet h4')[0].textContent = item.name;
                newImage.querySelectorAll('#productDet h4')[1].textContent = item.category;

                newImage.setAttribute("data-id", `${item.id}`);
                newImage.setAttribute("data-name", `${item.name}`);
                dataArray += newImage.outerHTML;
            });

            productContainer.innerHTML = dataArray;

            document.querySelectorAll('#image').forEach((img) =>
                img.addEventListener("click", function () {

                    // Set the product ID and name as hidden input values in the form
                    const productIdInput = document.getElementById("productIdInput");
                    const productNameInput = document.getElementById("productNameInput");
                    const productImageUrlInput = document.getElementById("productImageUrlInput");
                    const modalTitle = document.getElementById("productTitle");
                    const categorySelect = document.getElementById("percent");

                    const category = img.querySelectorAll('#productDet h4')[1].textContent;
                    if (category === "DRY") {
                        categorySelect.style.display = "none"
                        categorySelect.querySelector("input").value = 100
                    } else {
                        categorySelect.style.display = "block"
                        categorySelect.querySelector("input").value = ""
                    }
                    const title = `${img.querySelectorAll('#productDet h4')[0].textContent} ${img.querySelectorAll('#productDet h4')[1].textContent}`;

                    modalTitle.textContent = title;
                    productIdInput.value = this.getAttribute('data-id');
                    productNameInput.value = this.getAttribute('data-name');
                    productImageUrlInput.value = img.querySelector('#imgDisplayed').src;

                }))
        }

        //////////////////////////function to add data to table from create modal/////////////////////////////////////////
        function addTransactionDataToList() {
            // const imgElementDisplayed = document.querySelector('#imgDisplayed');
            // const imgUrl = imgElementDisplayed.src;

            const template = document.querySelector("#transaction-item-template").content
            const templateContent = template.cloneNode(true).querySelector("ul");

            const id = document.querySelector("#productIdInput").value
            const name = document.querySelector("#productNameInput").value
            const imgUrl = document.querySelector("#productImageUrlInput").value

            const pricePerUnit = document.querySelector("#pricePerUnit-m").value;
            const quantity = document.querySelector("#quantity-m").value;
            const cutQty = document.querySelector('#dropQty-m').value;
            const driedPercentage = document.querySelector('#driedPercentage-m').value;
            const quality = document.querySelector('#quality').value;
            const qtyAfterDropped = quantity - cutQty;

            if (!quantity || !pricePerUnit || !driedPercentage || !quality) {
                document.getElementById("error-message").style.display = "block";
                return false;
            } else {
                ///////////////////////////////////////
                templateContent.querySelector("h4").textContent = name
                templateContent.querySelector("#id").value = id
                templateContent.querySelector("#quality").value = quality
                templateContent.querySelector("#driedPercentage").value = driedPercentage

                templateContent.querySelectorAll("li")[0].querySelector('img').src = imgUrl
                templateContent.querySelectorAll("li")[1].textContent = pricePerUnit
                templateContent.querySelectorAll("li")[2].textContent = quantity
                templateContent.querySelectorAll("li")[3].textContent = qtyAfterDropped
                templateContent.querySelector(".total").textContent = calculateTotal(qtyAfterDropped, pricePerUnit)

                const randomId = Math.random() + Date.now()
                templateContent.setAttribute("data-id", randomId)

                const productTable = document.querySelector("#productTable")
                productTable.appendChild(templateContent);

                //adding event listener after adding to dom
                const deleteButton = productTable.querySelector(`[data-id='${randomId}'] [data-action='delete'] button`)
                deleteButton.addEventListener('click', () => {
                    const parentUl = deleteButton.parentElement.parentElement
                    deleteTransactionItem(parentUl.dataset.id)
                })

                reCalculateTotal()
                // Clear the input fields
                document.querySelector('#pricePerUnit-m').value = '';
                document.querySelector('#quantity-m').value = '';
                document.querySelector('#dropQty-m').value = '';
                document.querySelector('#driedPercentage-m').value = '';
                document.querySelector("#quality").selectedIndex = 0;
            }
            const createModal = document.getElementById('create');
            const modal = bootstrap.Modal.getInstance(createModal);
            if (modal) {
                modal.hide();
                // Clear the input fields
                document.querySelector('#pricePerUnit-m').value = '';
                document.querySelector('#quantity-m').value = '';
                document.querySelector('#dropQty-m').value = '';
                document.querySelector('#driedPercentage-m').value = '';
                document.querySelector("#quality").selectedIndex = 0;
            }

        }

        function calculateTotal(quantity, pricePerUnit) {//totalprice for each transaction
            return quantity * pricePerUnit
        }

        function reCalculateTotal() {
            const productTable = document.querySelector("#productTable")
            const finalTotal = Array.from(productTable.querySelectorAll(".total")).reduce((accumulator, itemTotal) => accumulator + Number(itemTotal.textContent), 0)

            const totalNode = document.querySelector("#total2")
            totalNode.textContent = finalTotal
            document.querySelector("#total").textContent = finalTotal

            document.querySelector("#totalItems").textContent = `Total items: ${Array.from(productTable.querySelectorAll(".total")).length}`
        }

        function deleteTransactionItem(productId) {
            const productTable = document.querySelector("#productTable")
            const transactionItem = productTable.querySelector(`[data-id="${productId}"]`)

            transactionItem.remove()
            reCalculateTotal() //recalculates final total when an item is deleted
        }

        ////////////////Send the records from table to server///////////////////////////
        const checkoutButton = document.getElementById('checkoutTotal');
        checkoutButton.addEventListener('click', function () {
            const total = document.querySelector('#total');
            const supplier = document.querySelector('#supplier').value;
            const parts = supplier.split("-");
            let id = null;
            if (parts.length === 2) {
                id = parts[1];
            }
            const invoice1 = {
                total: parseFloat(total.textContent.replace('Rs', '')),
                tradeType: "BOUGHT",
                person: {
                    "id": id
                },
                createdAt: new Date().toISOString()
            };

            const invoice2 = {
                total: parseFloat(total.textContent.replace('Rs', '')),
                tradeType: "BOUGHT",
                createdAt: new Date().toISOString()
            };
            let invoice = invoice2;
            if (id !== null) { invoice = invoice1 }
            axios.post('/api/invoice', invoice)
                .then(invoiceResponse => {
                    console.log(invoiceResponse.data)
                    const invoiceId = invoiceResponse.data.id;
                    const productTableLists = document.querySelectorAll('.product-lists');
                    const transactions = [];

                    for (let i = 1; i < productTableLists.length; i++) {
                        const row = productTableLists[i];
                        let dried = false;


                        if (row.querySelector('#driedPercentage').value > 95) { dried = true }

                        const record = {
                            "pricePerUnit": parseFloat(row.querySelectorAll('li')[1].textContent),
                            "qty": parseFloat(row.querySelectorAll('li')[2].textContent),
                            "qtyAfterDropped": parseFloat(row.querySelectorAll('li')[3].textContent),
                            "price": parseFloat(row.querySelectorAll('li')[4].textContent),
                            "dried": dried,
                            "quality": row.querySelector('#quality').value,
                            "dryPercent": parseFloat(row.querySelector('#driedPercentage').value),
                            "invoice": {
                                "id": invoiceId // Use the invoice ID obtained earlier
                            },
                            "product": {
                                "id": parseFloat(row.querySelector('#id').value),
                                "name":row.querySelector('h4').textContent
                            },
                            createdAt: new Date().toISOString()
                        };

                        transactions.push(record);
                        
                    }

                    axios.post('/api/transaction/purchase', transactions)
                        .then(response => {
                            displayAndPrintBill(transactions);
                            // modalPop('Transaction successful');
                        })
                        .catch(error => {
                            modalPop('Error sending transaction data:', error);
                        });
                    const productTable = document.querySelector('#productTable');
                    productTable.innerHTML = '';
                    document.getElementById('checkoutTotal').textContent = '0.00';
                })
                .catch(error => {
                    console.log(error.data)
                    modalPop('Error creating invoice:', error);
                });
        });



        ///////////////billllllllll///////////////////
        // JavaScript to populate and display the bill
        // Create an HTML table to display the bill
        function createBillHTML(transactions) {
            const total = document.querySelector('#total').textContent;
            const supplier = document.querySelector('#supplier').value;
            let billHTML = `
            <caption style="text-align:center;">SPICE SHOP</caption>
            <div style="display:flex;justify-content:space-between;width:100%">
                <p>Supplier name: ${supplier}</p>
                <p>Date : ${new Date().toISOString().split("T")[0]}</p> 
                </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Price per Unit</th>
                        <th>Quantity</th>
                        <th>Qty After Dropped</th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody>
        `;

            for (const transaction of transactions) {
                billHTML += `
                <tr>
                    <td>${transaction.product.name}</td>
                    <td>${transaction.pricePerUnit}</td>
                    <td>${transaction.qty}</td>
                    <td>${transaction.qtyAfterDropped}</td>
                    <td>${transaction.price}</td>
                </tr>
                `;
                    }
                

                    billHTML += ` 

                    </tbody>
                </table>

                <div style="border-bottom:1px double #000;padding-top:50px">
                        <p style="text-align:right;width:100%">Total   ${total}</p>
                </div>
            `;

            return billHTML;
        }

        // Function to display and print the bill
        function displayAndPrintBill(transactions) {
            const billHTML = createBillHTML(transactions);

            // Create a new window to display the bill
            const billWindow = window.open('', 'Bill', 'height=600,width=800');
            billWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Invoice Bill</title>
                    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
                </head>
                <body>
                    <div class="container">
                        <h2 class="text-center">Invoice Bill</h2>
                        ${billHTML}
                    </div>

                </body>
                </html>
            `);


            // Allow some time for the bill content to load
            setTimeout(() => {
                billWindow.print();
                billWindow.close();
            }, 100);
        }


        ///// END ///////////Send the records from table to server///////////////////////////

        const loadProducts = () => {
            axios.get('/api/product')
                .then(response => {
                    const products = response.data;
                    addProductsToPage(products);

                })
                .catch(error => {
                    modalPop('Error fetching products:', error)
                });
        }

        const loadSupplier = () => {
            axios.get('/api/person/supplier')
                .then(response => {
                    const suppliers = response.data;
                    const options = suppliers.map(supplier => `<option>${supplier.name}-${supplier.id}</option>`)
                    document.querySelector("#suppliers").innerHTML += options
                })
                .catch(error => {
                    modalPop('Error fetching suppliers:', error)
                });
        }

        //modal pupulate code
        function modalPop(value) {
            const modal = document.getElementById('resultModal');
            // Close the modal
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = '<p>' + value + '</p>';
            // Display the modal
            modal.style.display = 'block';

            // Close the modal when the user clicks the close button
            const closeBtn = document.querySelector('.close');
            closeBtn.onclick = function () {
                modal.style.display = 'none';
                location.reload();
            };
            return;
        }

        function validateInput(input) {
            const min = 1;
            const max = 100;

            if (input.value < min) {
                document.getElementById("error-messageMin").style.display = "block";
                return false;
            } else if (input.value > max) {
                document.getElementById("error-messageMin").style.display = "block";
                return false;
            } else {
                document.getElementById("error-messageMin").style.display = "none"
            }
        }


    </script>
    <script src="assets/js/axios.js"></script>

    <script src="assets/js/jquery-3.6.0.min.js"></script>

    <script src="assets/js/feather.min.js"></script>

    <script src="assets/js/jquery.slimscroll.min.js"></script>

    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <script src="assets/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/dataTables.bootstrap4.min.js"></script>

    <script src="assets/plugins/select2/js/select2.min.js"></script>

    <script src="assets/plugins/owlcarousel/owl.carousel.min.js"></script>

    <script src="assets/plugins/sweetalert/sweetalert2.all.min.js"></script>
    <script src="assets/plugins/sweetalert/sweetalerts.min.js"></script>

    <script src="assets/js/script.js"></script>
</body>

</html>